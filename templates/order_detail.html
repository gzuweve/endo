<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .order-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .order-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .order-title {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .order-meta {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .meta-label {
            font-weight: bold;
            opacity: 0.9;
        }

        .meta-value {
            font-size: 1.1em;
        }

        .deadline-overdue {
            color: #ff6b6b;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .order-content {
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        @media (max-width: 768px) {
            .order-content {
                grid-template-columns: 1fr;
            }
        }

        .info-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .document-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 8px;
            border-left: 4px solid #28a745;
        }

        .section-title {
            font-size: 1.4em;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 8px;
        }

        .info-details {
            line-height: 1.8;
        }

        .info-item {
            margin-bottom: 12px;
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .info-label {
            font-weight: bold;
            color: #495057;
        }

        .document-preview {
            width: 100%;
            height: 500px;
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            margin-bottom: 15px;
        }

        .document-placeholder {
            text-align: center;
            color: #6c757d;
        }

        .document-placeholder i {
            font-size: 3em;
            margin-bottom: 10px;
            color: #adb5bd;
        }

        .document-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: #007bff;
            color: white;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        .btn-work {
            background: #f39c12;
            color: white;
        }

        .btn-work:hover {
            background: #f39c12;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #28a745;
            color: white;
        }

        .btn-success:hover {
            background: #1e7e34;
            transform: translateY(-2px);
        }
        .btn-cancel {
            background: #6b6d6d;
            color: white;
        }
        .btn-cancel:hover {
            background: #6d6b6bd6;
            transform: translateY(-2px);
        }
        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .order-footer {
            background: #e9ecef;
            padding: 20px 30px;
            text-align: center;
            border-top: 1px solid #dee2e6;
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.9em;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-completed {
            background: #d1ecf1;
            color: #0c5460;
        }

        .status-overdue {
            background: #f8d7da;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="order-container">
        <!-- –®–∞–ø–∫–∞ –∑–∞–∫–∞–∑–∞ -->
        <div class="order-header">
            <h1 class="order-title">–ó–∞–∫–∞–∑ #{{ order.id }}</h1>
            <div class="order-meta">
                <div class="meta-item">
                    <span class="meta-label">–°—Ç–∞—Ç—É—Å:</span>
                    <span class="meta-value status-badge status-pending">{{ order.status }}</span>
                </div>
                {% if order.status == "–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω" or order.status == "–í —Ä–∞–±–æ—Ç–µ" %}
                    <div class="meta-item">
                        <span class="meta-label">–î–µ–¥–ª–∞–π–Ω:</span>
                        <span class="meta-value {% if order.is_overdue %}deadline-overdue{% endif %}">
                            {{ order.deadline }}
                        </span>

                    </div>
                {% endif %}
            </div>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="order-content">
            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ -->
            <div class="info-section">
                <h2 class="section-title">üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ</h2>
                <div class="info-details">
                    <div class="info-item">
                        <span class="info-label">–¢–æ–≤–∞—Ä:</span>
                        <span class="info-value">{{ order.material.name }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:</span>
                        <span class="info-value">{{ order.material.information|default:"–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç" }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">–ß–µ—Ä—Ç—ë–∂:</span>
                        <a href = "{{ order.material.drawing.url }}" class="info-value">–°–∫–∞—á–∞—Ç—å</a>
                    </div>
                </div>
            </div>



        </div>

        <!-- –§—É—Ç–µ—Ä —Å –¥–µ–π—Å—Ç–≤–∏—è–º–∏ -->
        <div class="order-footer">
            <div class="document-actions">
                <a href="{% url 'home' %}" class="btn btn-primary">
                    ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É
                </a>
                {% if order.status == "–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω" %}
                 <button class="btn btn-work" onclick="takeorder()">
                     –í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É
                </button>
                {% endif %}
                {% if order.status == "–í —Ä–∞–±–æ—Ç–µ" %}
                <button class="btn btn-success" onclick="finishtheorder()">
                    –ó–∞–≤–µ—Ä—à–∏—Ç—å —Ä–∞–±–æ—Ç—É
                </button>
                 <button class="btn btn-cancel" onclick="canceltheorder()">
                    –û—Ç–º–µ–Ω–∏—Ç—å —Ä–∞–±–æ—Ç—É
                </button>
                {% endif %}
                {% if order.status == "–í—ã–ø–æ–ª–Ω–µ–Ω" %}
                <button class="btn btn-danger" onclick="returnorder()">
                    –í–µ—Ä–Ω—É—Ç—å –≤ —Ä–∞–±–æ—Ç—É
                </button>
                {% endif %}
            </div>
        </div>
    </div>

    <script>
        function printDocument() {
            if ("{{ order.drawing }}") {
                window.open("{{ order.drawing.url }}", '_blank').print();
            } else {
                alert('–ß–µ—Ä—Ç–µ–∂ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
            }
        }

        function uploadDocument() {
            alert('–§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –±—É–¥–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–¥–µ—Å—å');
            // –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞
        }

        function markAsCompleted() {
            if (confirm('–û—Ç–º–µ—Ç–∏—Ç—å –∑–∞–∫–∞–∑ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–π?')) {
                // –õ–æ–≥–∏–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–≥–æ
                alert('–ó–∞–∫–∞–∑ –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–π');
            }
        }

        function editOrder() {
            alert('–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞');
            // –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
        }

        function deleteOrder() {
            if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑?')) {
                if (confirm('–≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å! –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ —É–¥–∞–ª–µ–Ω–∏–µ.')) {
                    // –õ–æ–≥–∏–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
                    alert('–ó–∞–∫–∞–∑ —É–¥–∞–ª–µ–Ω');
                    window.location.href = "{% url 'home' %}";
                }
            }
        }

        // –ê–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –¥–µ–¥–ª–∞–π–Ω–∞
        function updateDeadlineStatus() {
            const deadlineElements = document.querySelectorAll('.deadline-overdue');
            deadlineElements.forEach(element => {
                element.innerHTML = 'üö® –ü–†–û–°–†–û–ß–ï–ù–û';
            });
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        document.addEventListener('DOMContentLoaded', function() {
            updateDeadlineStatus();
        });
        function takeorder() {
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤–∑—è—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑ –≤ —Ä–∞–±–æ—Ç—É?")) {
                updateOrderStatus("–í —Ä–∞–±–æ—Ç–µ");
            }
        }
        function finishtheorder() {
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑?")) {
                updateOrderStatus("–í—ã–ø–æ–ª–Ω–µ–Ω");
            }
        }

        function canceltheorder() {
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —Ä–∞–±–æ—Ç—É –Ω–∞–¥ —ç—Ç–∏–º –∑–∞–∫–∞–∑–æ–º?")) {
                updateOrderStatus("–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω");
            }
        }

        function returnorder() {
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –≤–µ—Ä–Ω—É—Ç—å —ç—Ç–æ—Ç –∑–∞–∫–∞–∑ –≤ —Ä–∞–±–æ—Ç—É?")) {
                updateOrderStatus("–í —Ä–∞–±–æ—Ç–µ");
            }
        }

        function updateOrderStatus(newStatus) {
            // –ü–æ–ª—É—á–∞–µ–º ID –∑–∞–∫–∞–∑–∞ –∏–∑ —à–∞–±–ª–æ–Ω–∞
            const orderId = "{{ order.id }}";

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º PATCH –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–µ—Ä–≤–µ—Ä
            fetch(`/order/${orderId}/update/status/`, {
                method: 'PATCH',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCookie('csrftoken') // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è CSRF —Ç–æ–∫–µ–Ω–∞
                },
                body: JSON.stringify({
                    status: newStatus
                })
            })
            .then(response => {
                if (response.ok) {
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
                    window.location.reload();
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞');
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è CSRF —Ç–æ–∫–µ–Ω–∞
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</body>
</html>